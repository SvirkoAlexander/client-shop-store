{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sasha/Desktop/Shop-headphone/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sasha/Desktop/Shop-headphone/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{BsCartX}from\"react-icons/bs\";import{MdClose}from\"react-icons/md\";import CartItem from\"./CartItem/CartItem\";import{loadStripe}from\"@stripe/stripe-js\";import{makePaymentRequest}from\"../../utils/api\";import{useContext}from\"react\";import{useNavigate}from\"react-router-dom\";import{Context}from\"../../utils/context\";import\"./Cart.scss\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Cart=function Cart(_ref){var setShowCart=_ref.setShowCart;var _useContext=useContext(Context),cartItems=_useContext.cartItems,cartSubTotal=_useContext.cartSubTotal;var navigate=useNavigate();var stripePromise=loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);var handlePayment=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var stripe,res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return stripePromise;case 3:stripe=_context.sent;_context.next=6;return makePaymentRequest.post(\"api/orders/\",{products:cartItems});case 6:res=_context.sent;_context.next=9;return stripe.redirectToCheckout({sessionId:res.data.stripeSession.id});case 9:_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 14:case\"end\":return _context.stop();}},_callee,null,[[0,11]]);}));return function handlePayment(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"cart-panel\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"opac-layer\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cart-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"heading\",children:\"\\u0412\\u0430\\u0448\\u0430 \\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"close-btn\",onClick:function onClick(){return setShowCart(false);},children:[/*#__PURE__*/_jsx(MdClose,{}),/*#__PURE__*/_jsx(\"span\",{className:\"text\",children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})]})]}),!(cartItems!==null&&cartItems!==void 0&&cartItems.length)&&/*#__PURE__*/_jsxs(\"div\",{className:\"empty-cart\",children:[/*#__PURE__*/_jsx(BsCartX,{}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u041D\\u0435\\u0442 \\u0442\\u043E\\u0432\\u0430\\u0440\\u043E\\u0432 \\u0432 \\u043A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0435.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"return-cta\",onClick:function onClick(){navigate(\"/\");setShowCart(false);},children:\"\\u041D\\u0410\\u0417\\u0410\\u0414 \\u041A \\u041F\\u041E\\u041A\\u0423\\u041F\\u041A\\u0410\\u041C\"})]}),!!(cartItems!==null&&cartItems!==void 0&&cartItems.length)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CartItem,{setShowCart:setShowCart}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-footer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"subtotal\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text\",children:\"\\u0418\\u0442\\u043E\\u0433\\u043E:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text total\",children:[cartSubTotal,\" $\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"button\",children:/*#__PURE__*/_jsx(\"button\",{className:\"checkout-cta\",onClick:handlePayment,children:\"\\u041E\\u043F\\u043B\\u0430\\u0442\\u0438\\u0442\\u044C\"})})]})]})]})]});};export default Cart;","map":{"version":3,"names":["BsCartX","MdClose","CartItem","loadStripe","makePaymentRequest","useContext","useNavigate","Context","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Cart","_ref","setShowCart","_useContext","cartItems","cartSubTotal","navigate","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","handlePayment","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","stripe","res","wrap","_callee$","_context","prev","next","sent","post","products","redirectToCheckout","sessionId","data","stripeSession","id","t0","console","log","stop","apply","arguments","className","children","onClick","length"],"sources":["/Users/sasha/Desktop/Shop-headphone/client/src/components/Cart/Cart.jsx"],"sourcesContent":["import { BsCartX } from \"react-icons/bs\";\nimport { MdClose } from \"react-icons/md\";\nimport CartItem from \"./CartItem/CartItem\";\n\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { makePaymentRequest } from \"../../utils/api\";\nimport { useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Context } from \"../../utils/context\";\nimport \"./Cart.scss\";\n\nconst Cart = ({ setShowCart }) => {\n  const { cartItems, cartSubTotal } = useContext(Context);\n  const navigate = useNavigate();\n\n  const stripePromise = loadStripe(\n    process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY\n\t);\n\t\n\tconst handlePayment = async () => {\n\t\ttry {\n\t\t\tconst stripe = await stripePromise\n\t\tconst res = await makePaymentRequest.post(\"api/orders/\", {\n\t\t\tproducts: cartItems,\n\t\t})\n\n\t\tawait stripe.redirectToCheckout({\n\t\t\tsessionId: res.data.stripeSession.id,\n\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.log(error)\n\t\t}\n\t\t\n\t}\n\n  return (\n    <div className=\"cart-panel\">\n      <div className=\"opac-layer\"></div>\n      <div className=\"cart-content\">\n        <div className=\"cart-header\">\n          <span className=\"heading\">Ваша Корзина</span>\n          <span className=\"close-btn\" onClick={() => setShowCart(false)}>\n            <MdClose />\n            <span className=\"text\">Закрыть</span>\n          </span>\n        </div>\n        {!cartItems?.length && (\n          <div className=\"empty-cart\">\n            <BsCartX />\n            <span>Нет товаров в корзине.</span>\n            <button\n              className=\"return-cta\"\n              onClick={() => {\n                navigate(\"/\");\n                setShowCart(false);\n              }}\n            >\n              НАЗАД К ПОКУПКАМ\n            </button>\n          </div>\n        )}\n\n        {!!cartItems?.length && (\n          <>\n            <CartItem setShowCart={setShowCart} />\n            <div className=\"cart-footer\">\n              <div className=\"subtotal\">\n                <span className=\"text\">Итого:</span>\n                <span className=\"text total\">{cartSubTotal} $</span>\n              </div>\n              <div className=\"button\">\n                <button className=\"checkout-cta\" onClick ={handlePayment}>\n                  Оплатить\n                </button>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Cart;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}